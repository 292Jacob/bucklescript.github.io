<html><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"/><title>與原生 OCaml 差異 · BuckleScript</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="與原生 OCaml 差異 · BuckleScript"/><meta property="og:type" content="website"/><meta property="og:url" content="https://bucklescript.github.io/index.html"/><meta property="og:description" content="This is particularly important when porting an existing OCaml application to JavaScript."/><link rel="shortcut icon" href="/img/logos/bucklescript_small.svg"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/arduino-light.min.css"/><link rel="alternate" type="application/atom+xml" href="https://bucklescript.github.io/blog/atom.xml" title="BuckleScript Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://bucklescript.github.io/blog/feed.xml" title="BuckleScript Blog RSS Feed"/><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logos/bucklescript_small.svg"/><h2 class="headerTitle">BuckleScript</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li><a href="/docs/zh-TW/installation.html" target="_self">文件</a></li><li><a href="/docs/zh-TW/playground.html" target="_self">體驗</a></li><li><a href="/docs/zh-TW/stdlib-overview.html" target="_self">API</a></li><li><a href="/docs/zh-TW/community.html" target="_self">社群</a></li><li><a href="/blog" target="_self">部落格</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg"/>繁體中文</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/ja">日本語</a></li><li><a href="/en">English</a></li><li><a href="/es-ES">Español</a></li><li><a href="/fr">Français</a></li><li><a href="/ko">한국어</a></li><li><a href="/pt-BR">Português (Brasil)</a></li><li><a href="/ru">Русский</a></li><li><a href="/zh-CN">中文</a></li><li><a href="https://crowdin.com/project/bucklescript" target="_blank">協助翻譯</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(){
          if(languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search"/></li><li><a href="https://github.com/bucklescript/bucklescript" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Advanced</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>簡介</h3><ul><li class="navListItem"><a class="navItem" href="/docs/zh-TW/what-why.html">什麼 &amp; 為何</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/installation.html">安裝</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/new-project.html">新增專案</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/concepts-overview.html">概念概述</a></li></ul></div><div class="navGroup navGroupActive"><h3>交互作用</h3><ul><li class="navListItem"><a class="navItem" href="/docs/zh-TW/interop-overview.html">概覽</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/interop-cheatsheet.html">快捷手冊</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/embed-raw-javascript.html">嵌入原始 JavaScript</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/common-data-types.html">常見資料型別</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/intro-to-external.html">External 介紹</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/bind-to-global-values.html">繫結全域值</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/null-undefined-option.html">Null、Undefined &amp; Option</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/object.html">物件</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/class.html">Class</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/function.html">函式</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/import-export.html">匯入 &amp; 匯出</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/regular-expression.html">正規表示式</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/exceptions.html">例外</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/json.html">JSON</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/generate-converters-accessors.html">產生轉譯器 &amp; Helpers</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/nodejs-special-variables.html">NodeJS 特殊變數</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/interop-misc.html">其他設定</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/typescript-support.html">TypeScript 支援</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/browser-support-polyfills.html">瀏覽器支援 &amp; Polyfills</a></li></ul></div><div class="navGroup navGroupActive"><h3>建置系統</h3><ul><li class="navListItem"><a class="navItem" href="/docs/zh-TW/build-overview.html">概覽</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/build-configuration.html">配置</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/automatic-interface-generation.html">自動產生介面</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/interop-with-js-build-systems.html">與 JS 建置系統交互作用</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/build-performance.html">效能</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/build-advanced.html">進階</a></li></ul></div><div class="navGroup navGroupActive"><h3>標準函式庫</h3><ul><li class="navListItem"><a class="navItem" href="/docs/zh-TW/stdlib-overview.html">概要</a></li></ul></div><div class="navGroup navGroupActive"><h3>進階</h3><ul><li class="navListItem"><a class="navItem" href="/docs/zh-TW/conditional-compilation.html">條件編譯</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/extended-compiler-options.html">擴展編譯器選項</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/use-existing-ocaml-libraries.html">使用既有 OCaml 函式庫</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/docs/zh-TW/difference-from-native-ocaml.html">與原生 OCaml 差異</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/compiler-architecture-principles.html">編譯器架構 &amp; 原則</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/comparison-to-jsoo.html">與 Js_of_ocaml 的比較</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://crowdin.com/project/bucklescript/zh-TW" target="_blank">Translate</a><h1>與原生 OCaml 差異</h1></header><article><div><span><p>This is particularly important when porting an existing OCaml application to JavaScript.</p>
<h2><a class="anchor" aria-hidden="true" name="custom-data-type"></a><a href="#custom-data-type" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Custom Data Type</h2>
<p>In OCaml, the C FFI allows the user to define a custom data type and customize <code>caml_compare</code>, <code>caml_hash</code> behavior, etc. This is not available in our backend (since we have no C FFI).</p>
<h2><a class="anchor" aria-hidden="true" name="physical-in-equality"></a><a href="#physical-in-equality" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Physical (in)equality</h2>
<p>In general, only use physical equality as an optimization technique; don't rely on its correctness, since it is tightly coupled with the runtime.</p>
<h2><a class="anchor" aria-hidden="true" name="string-char-range"></a><a href="#string-char-range" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>String Char Range</h2>
<p>Currently, BuckleScript assumes that the char range is 0-255. The user should be careful when they pass a JavaScript string to the OCaml side. We are working on a solution for this problem.</p>
<h2><a class="anchor" aria-hidden="true" name="weak-map"></a><a href="#weak-map" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Weak Map</h2>
<p>OCaml’s weak map is not available in BuckleScript. The weak pointer is replaced by a strict pointer.</p>
<h2><a class="anchor" aria-hidden="true" name="integers"></a><a href="#integers" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Integers</h2>
<p>OCaml has <code>int</code>, <code>int32</code>, <code>nativeint</code> and <code>int64</code> types.</p>
<ul>
<li>Both <code>int32</code> and <code>int64</code> in BuckleScript have the exact same semantics as OCaml.</li>
<li><code>int</code> in BuckleScript is the same as <code>int32</code> while in OCaml it’s platform dependent.</li>
<li><code>nativeint</code> is treated as JavaScript float, except for division. For example, <code>Nativeint.div a b</code> will be translated into <code>a / b | 0</code>.</li>
</ul>
<p><strong>Note</strong>: <code>Nativeint.shift_right_logical x 0</code> is different from <code>Int32.shift_right_local x 0</code>. The former is literally translated into <code>x &gt;&gt;&gt; 0</code> (translated into an unsigned int), while the latter is <code>x | 0</code>.</p>
<h2><a class="anchor" aria-hidden="true" name="printfprintf"></a><a href="#printfprintf" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Printf.printf</h2>
<p>The Printf.print implementation in BuckleScript requires a newline (<code>\n</code>) to trigger the printing. This behavior is not consistent with the buffered behavior of native OCaml. The only potential problem we foresee is that if the program terminates with no newline character, the text will never be printed.</p>
<h2><a class="anchor" aria-hidden="true" name="obj-module"></a><a href="#obj-module" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Obj Module</h2>
<p>We do our best to mimic the native compiler, but we have no guarantee and there are differences.</p>
<h2><a class="anchor" aria-hidden="true" name="hashtbl-hash-algorithm"></a><a href="#hashtbl-hash-algorithm" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hashtbl Hash Algorithm</h2>
<p>BuckleScript uses the same algorithm as native OCaml, but the output is different due to the runtime representation of int/int64/int32 and float.</p>
<h2><a class="anchor" aria-hidden="true" name="marshall-module"></a><a href="#marshall-module" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Marshall Module</h2>
<p>Not supported yet.</p>
<h2><a class="anchor" aria-hidden="true" name="sysargv-sysmax-array-length-sysmax-string-length"></a><a href="#sysargv-sysmax-array-length-sysmax-string-length" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sys.argv, Sys.max_array_length, Sys.max_string_length</h2>
<p>Command line arguments are always empty. This might be fixed in the future. <code>Sys.max_array_length</code> and <code>Sys.max_string_length</code> will be the same as <code>max_int</code>, but it might be respected.</p>
<h2><a class="anchor" aria-hidden="true" name="unsupported-io-primitives"></a><a href="#unsupported-io-primitives" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Unsupported IO Primitives</h2>
<p>Because of the JS environment limitation, <code>Pervasives.stdin</code> is not supported but both <code>Pervasives.stdout</code> and <code>Pervasives.stderr</code> are.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="use-existing-ocaml-libraries.html">← 使用既有 OCaml 函式庫</a><a class="docs-next button" href="compiler-architecture-principles.html">編譯器架構 &amp; 原則 →</a></div></div></div></div><span><script src="/js/redirectBlog.js"></script><script src="/js/pjax-api.js"></script><script>window.foo = new Pjax({
          areas: [
            // try to use the first query.
            '.mainContainer, .docsNavContainer .toc .navWrapper',
            // fallback
            'body'
          ],
          link: '.docsNavContainer:not(.docsSliderActive) a',
          update: {
            script: false,
          }
        });
        var languagesMenuItemCopy = document.getElementById("languages-menu");
        languagesMenuItemCopy.addEventListener("click", function(e){
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
        });</script></span></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
              var search = docsearch({
                apiKey: '0fd97db83891aa20810559812d9e69ac',
                indexName: 'bucklescript',
                inputSelector: '#search_input_react'
              });
            </script></body></html>