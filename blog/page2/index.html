<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Blog · BuckleScript</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="A faster, simpler and more robust take on JavaScript."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Blog · BuckleScript"/><meta property="og:type" content="website"/><meta property="og:url" content="https://bucklescript.github.io/"/><meta property="og:description" content="A faster, simpler and more robust take on JavaScript."/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/logos/bucklescript.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"/><link rel="alternate" type="application/atom+xml" href="https://bucklescript.github.io/blog/atom.xml" title="BuckleScript Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://bucklescript.github.io/blog/feed.xml" title="BuckleScript Blog RSS Feed"/><script type="text/javascript" src="/js/toggleSyntaxButton.js"></script><script type="text/javascript" src="/js/pjax-api.min.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="blog"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/en"><img class="logo" src="/img/logos/bucklescript.svg" alt="BuckleScript"/><h2 class="headerTitleWithLogo">BuckleScript</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/en/installation" target="_self">Docs</a></li><li class=""><a href="/docs/en/playground" target="_self">Try</a></li><li class=""><a href="/docs/en/stdlib-overview" target="_self">API</a></li><li class=""><a href="/docs/en/community" target="_self">Community</a></li><li class="siteNavGroupActive siteNavItemActive"><a href="/blog/" target="_self">Blog</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>English</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/ja">日本語</a></li><li><a href="/es-ES">Español</a></li><li><a href="/fr">Français</a></li><li><a href="/ko">한국어</a></li><li><a href="/pt-BR">Português (Brasil)</a></li><li><a href="/ru">Русский</a></li><li><a href="/zh-CN">中文</a></li><li><a href="/zh-TW">繁體中文</a></li><li><a href="https://crowdin.com/project/bucklescript" target="_blank" rel="noreferrer noopener">Help Translate</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><li class=""><a href="https://github.com/bucklescript/bucklescript" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Recent Posts</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Recent Posts</h3><ul class=""><li class="navListItem"><a class="navItem" href="/blog/2020/02/20/loading-stdlib-in-memory">Loading stdlib from memory</a></li><li class="navListItem"><a class="navItem" href="/blog/2020/02/07/union-types-in-bucklescript">Union types in BuckleScript</a></li><li class="navListItem"><a class="navItem" href="/blog/2020/02/04/release-7-1-0">bs-platform release 7.1.0</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/12/27/whats-new-in-7-cont">What&#x27;s new in release 7 (cont)</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/12/20/release-7-02">BuckleScript holiday release!</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer postContainer blogContainer"><div class="wrapper"><div class="posts"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2019/05/21/ffi-overview">A high level overview of BuckleScript interop with Javascript</a></h1><p class="post-meta">May 21, 2019</p><div class="authorBlock"></div></header><article class="post-content"><div><span><p>When users start to use BuckleScript to develop applications on JS platform, they have to interop with various APIs provided by the JS platform.</p>
<p>In theory, like <a href="https://elm-lang.org/">Elm</a>, BuckleScript could ship a comprehensive library which contains what most people would like to use daily.
This, however, is particularly challenging, given that
JS is running on so many platforms for example, <a href="https://electronjs.org/">Electron</a>, <a href="https://nodejs.org/">Node</a> and Browser, yet each platform is still evolving quickly. So we have to provide a mechanism to allow users to bind to the native JS API quickly in userland.</p>
<p>There are lots of trade-off when designing such a FFI bridge between OCaml and the JavaScript API. Below, we list a few key items which we think have an important impact on our design.</p>
<h2><a class="anchor" aria-hidden="true" id="interop-design-constraints"></a><a href="#interop-design-constraints" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Interop design constraints</h2>
<ul>
<li><p>BuckleScript is still OCaml</p>
<p>We are not inventing a new language. In particular, we can not change the concrete syntax of OCaml. Luckily, OCaml introduced <a href="https://caml.inria.fr/pub/docs/manual-ocaml/extn.html#sec260">attributes</a> and <a href="https://caml.inria.fr/pub/docs/manual-ocaml/extn.html#sec262">extension nodes</a> since 4.02, which allows us to customize the language to a minor extent. To be a good citizen in the OCaml community, all attributes introduced by BuckleScript are prefixed with <code>bs</code>.</p></li>
<li><p>Bare metal efficiency should always be possible for experts in pure OCaml</p>
<p>Efficiency is at the heart of BuckleScript's design philosophy, in terms of both compilation speed and runtime performance. While there were other strongly typed functional languages running on the JS platform before we made BuckleScript, one thing in particular that confused me was that in those languages, people have to write <code>native JS</code> to gain performance. Our goal is that when performance really matters, it is still possible for experts to write pure OCaml without digging into <code>native JS</code>, so users don't have to make a choice between performance and type safety.</p></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="easy-interop-using-raw-js"></a><a href="#easy-interop-using-raw-js" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Easy interop using raw JS</h2>
<p>BuckleScript allows users to insert raw JS using extension nodes directly. Please refer to the <a href="https://bucklescript.github.io/docs/en/embed-raw-javascript">documentation</a> for details. Here we only talk about one of the most used styles: inserting raw JS code as a function.</p>
<pre><code class="hljs css language-ocaml"><span class="hljs-keyword">let</span> getSafe : <span class="hljs-built_in">int</span> <span class="hljs-built_in">array</span> -&gt; <span class="hljs-built_in">int</span> -&gt; <span class="hljs-built_in">int</span> = <span class="hljs-keyword">fun</span>%raw a b -&gt; {| 
    <span class="hljs-keyword">if</span> (b&gt;=<span class="hljs-number">0</span> &amp;&amp; b &lt; a.length) {
        return a [b]
     }
     throw <span class="hljs-keyword">new</span> <span class="hljs-type">Error</span>(<span class="hljs-string">"out of range"</span>)
  |} 

<span class="hljs-keyword">let</span> v = getSafe [|<span class="hljs-number">1</span>;<span class="hljs-number">2</span>;<span class="hljs-number">3</span>|] (-<span class="hljs-number">1</span>)
</code></pre>
<pre><code class="hljs css language-reason"><span class="hljs-keyword">let</span> getSafe: (array(int), int) =&gt; int = <span class="hljs-attribute">[%raw
  (a, b) =&gt; {|
    if (b&gt;=0 &amp;&amp; b &lt; a.length) {
        return a [b]</span>
     }
     throw <span class="hljs-keyword">new</span> <span class="hljs-constructor">Error</span>(<span class="hljs-string">"out of range"</span>)
  |}
<span class="hljs-literal">]</span>;

<span class="hljs-keyword">let</span> v = <span class="hljs-literal">[|</span><span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span><span class="hljs-literal">|]</span><span class="hljs-operator">-&gt;</span>getSafe<span class="hljs-number">(-1)</span>;
</code></pre>
<p>Here the raw extension node asks the user to list the parameters and function statement in raw JS syntax. The generated JS code is as follows:</p>
<pre><code class="hljs css language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSafe</span> (<span class="hljs-params">a,b</span>)</span>{ 
    <span class="hljs-keyword">if</span> (b&gt;=<span class="hljs-number">0</span> &amp;&amp; b &lt; a.length) {
        <span class="hljs-keyword">return</span> a [b]
     }
     <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"out of range"</span>)
  };

<span class="hljs-keyword">var</span> v = getSafe(<span class="hljs-comment">/* array */</span>[
      <span class="hljs-number">1</span>,
      <span class="hljs-number">2</span>,
      <span class="hljs-number">3</span>
    ], <span class="hljs-number">-1</span>);

</code></pre>
<p>Inserting raw JS code as a function has several advantages:</p>
<ul>
<li>It is relatively safe; there is no variable name polluting.</li>
<li>It is quite expressive since the user can express everything inside the function body.</li>
<li>The compiler still has some knowledge about the function, for example, its arity.</li>
</ul>
<p>Some advice about using this style:</p>
<ul>
<li>Always annotate the raw function with explicit type annotation.</li>
<li>When annotating raw JS, you can use polymorphic types, but don’t create them when you don’t really need them. In general, non polymoprhic type is safer and more efficient.</li>
<li>Write a unit test for the function.</li>
</ul>
<p>Note that a nice thing about this mechanism is that no separate JS file is needed, so no change to the build system is necessary in most cases. By using this mechanism, BuckleScript users can already deal with most bindings.</p>
<h2><a class="anchor" aria-hidden="true" id="interop-via-attributes"></a><a href="#interop-via-attributes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Interop via attributes</h2>
<p>If you are a developer busy shipping, the mechanism above should cover almost everything you need. A minor disadvange of that mechanism is that it comes with a cost: a raw function can not be inlined since it is JavaScript, so the BuckleScript compiler does not have a deep knowledge about the function.</p>
<p>To demonstrate interop via attributes, we are going to show a small example of binding to JS <code>date</code>. There are lots of advanced topics in the <a href="https://bucklescript.github.io/docs/en/interop-overview">documentation</a>; here we are only talking about one of the most-used methods for interop.</p>
<p>The key idea is to bind your JS object as <a href="https://en.wikipedia.org/wiki/Abstract_data_type">an abstract data type</a> where a data type is defined by its behavior from the point of view of a user of the data, instead of the data type’s concrete representations.</p>
<pre><code class="hljs css language-ocaml"><span class="hljs-keyword">type</span> date
<span class="hljs-keyword">external</span> fromFloat : <span class="hljs-built_in">float</span> -&gt; date = <span class="hljs-string">"Date"</span> [@@bs.<span class="hljs-keyword">new</span>]
<span class="hljs-keyword">external</span> getDate : date -&gt; <span class="hljs-built_in">float</span> = <span class="hljs-string">"getDate"</span> [@@bs.send]
<span class="hljs-keyword">external</span> setDate : date -&gt; <span class="hljs-built_in">float</span> -&gt; <span class="hljs-built_in">unit</span> = <span class="hljs-string">"setDate"</span> [@@bs.send]

<span class="hljs-keyword">let</span> date = fromFloat <span class="hljs-number">10000.</span>
<span class="hljs-keyword">let</span> <span class="hljs-literal">()</span> = setDate date <span class="hljs-number">3.</span>
<span class="hljs-keyword">let</span> d = getDate date
</code></pre>
<pre><code class="hljs css language-reason"><span class="hljs-keyword">type</span> date;

<span class="hljs-attribute">[@bs.new]</span>
<span class="hljs-keyword">external</span> fromFloat : float =&gt; date = <span class="hljs-string">"Date"</span> ;
<span class="hljs-attribute">[@bs.send]</span>
<span class="hljs-keyword">external</span> getDate : date =&gt; float = <span class="hljs-string">"getDate"</span> ;
<span class="hljs-attribute">[@bs.send]</span>
<span class="hljs-keyword">external</span> setDate : date =&gt; float =&gt; unit = <span class="hljs-string">"setDate"</span>;

<span class="hljs-keyword">let</span> date = fromFloat (<span class="hljs-number">10000.0</span>);
date<span class="hljs-operator">-&gt;</span>setDate (<span class="hljs-number">3.0</span>);
<span class="hljs-keyword">let</span> d = date <span class="hljs-operator">-&gt;</span> getDate;
</code></pre>
<p>The preceding code generates the following JS. As you can see, the binding itself is zero cost and serves as formal documentation.</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">var</span> date = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">10000</span>);
date.setDate(<span class="hljs-number">3</span>);
<span class="hljs-keyword">var</span> d = date.getDate();
</code></pre>
<p>A typical workflow is that we create an abstract data type, create bindings for a “maker” using <code>bs.new</code>, and bind methods using <code>bs.send</code>.</p>
<p>Thanks to native support of abstract data types in OCaml, the interop is easy to reason about.</p>
<p>Some advice when using this style:</p>
<ul>
<li>Again, you can use polymorphic types in your annotations, but don't create polymorphic types when you don't need them.</li>
<li>Write a unit test for each external.</li>
</ul>
<p>As a comparison, we can create the same binding using <code>raw</code>:</p>
<pre><code class="hljs css language-ocaml">type date
let fromFloat : float -&gt; date = fun%raw d -&gt; {|return new Date(d)|}
let getDate : date -&gt; float = fun%raw d -&gt; {|return d.getDate()|}
let setDate : date -&gt; float -&gt; unit = fun%raw d v -&gt; {|
   d.setDate(v);
   return 0; // ocaml representation of unit 
|}

let date = fromFloat 10000.
let () = setDate date 3.
let d = getDate date
</code></pre>
<pre><code class="hljs css language-reason"><span class="hljs-keyword">type</span> date;
<span class="hljs-keyword">let</span> fromFloat: float =&gt; date = <span class="hljs-attribute">[%raw d =&gt; {|return new Date(d)|}]</span>;
<span class="hljs-keyword">let</span> getDate: date =&gt; float = <span class="hljs-attribute">[%raw d =&gt; {|return d.getDate()|}]</span>;
<span class="hljs-keyword">let</span> setDate: (date, float) =&gt; unit = <span class="hljs-attribute">[%raw
  (d, v) =&gt; {|
   d.setDate(v);
   return 0; // ocaml representation of unit
|}
]</span>;

<span class="hljs-keyword">let</span> date = fromFloat(<span class="hljs-number">10000.</span>);
date<span class="hljs-operator">-&gt;</span>setDate( <span class="hljs-number">3.</span>);
<span class="hljs-keyword">let</span> d = date<span class="hljs-operator">-&gt;</span>getDate;

</code></pre>
<p>The generated JS is as follows, and you can see the cost:</p>
<pre><code class="hljs css language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fromFloat</span> (<span class="hljs-params">d</span>)</span>{<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(d)};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDate</span> (<span class="hljs-params">d</span>)</span>{<span class="hljs-keyword">return</span> d.getDate()};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setDate</span> (<span class="hljs-params">d,v</span>)</span>{
   d.setDate(v);
   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// ocaml representation of unit </span>
};

<span class="hljs-keyword">var</span> date = fromFloat(<span class="hljs-number">10000</span>);

setDate(date, <span class="hljs-number">3</span>);

<span class="hljs-keyword">var</span> d = getDate(date);
</code></pre>
<!-- ,  and provide various methods over such abstract data type. -->
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2019/04/22/release-5-0-4">architecture changes in bs-platform v5.0.4 and v6.0.1</a></h1><p class="post-meta">April 22, 2019</p><div class="authorBlock"></div></header><article class="post-content"><div><span><p>We are going to make releases of bs-platform@5.0.4 and bs-platform@6.0.1, this release mostly contains bug fixes.</p>
<p>At the same time, we are introducing an internal change which should be fine for average users.</p>
<p>If you are tooling authors, here are some details: previously we ship react_jsx ppx as a stand-alone binary, for example, reactjs_jsx_ppx_v2.exe, reactjs_jsx_ppx_v2.exe. Recently we start more close integration with <a href="https://reasonml.github.io">reason</a>, so it is absorbed into bsc.exe itself, we introduced a flag to have react-jsx on/off (note these are internal flags, not expected to be exposed to average users):</p>
<pre><code class="hljs"><span class="hljs-keyword">bsc.exe </span>-<span class="hljs-keyword">bs-jsx </span><span class="hljs-number">2</span> <span class="hljs-comment"># turn on reactjs_jsx_ppx_v2</span>
<span class="hljs-keyword">bsc.exe </span>-<span class="hljs-keyword">bs-jsx </span><span class="hljs-number">3</span> <span class="hljs-comment"># turn on reactjs_jsx_ppx_v3</span>
</code></pre>
<p>Like before, we also ship a stand alone bsppx.exe, it now absorbs reactjs_jsx_ppx as well.</p>
<pre><code class="hljs"><span class="hljs-keyword">bsppx.exe </span>-<span class="hljs-keyword">bs-jsx </span><span class="hljs-number">2</span> <span class="hljs-comment"># turn on reactjs_jsx_ppx_v2</span>
<span class="hljs-keyword">bsppx.exe </span>-<span class="hljs-keyword">bs-jsx </span><span class="hljs-number">3</span> <span class="hljs-comment"># turn on reactjs_jsx_ppx_v3</span>
</code></pre>
<p>The benefit of this change is that it help reduced the prebuilt binary size significantly and it also help shave 5~10ms per file compilation.</p>
<p>Another minor change we added, is that we introduced an env variable <code>BS_VSCODE</code> to help error messages more adapted to VsCode, see <a href="https://bucklescript.github.io/docs/en/build-configuration#bs-vscode-error-output-adapted-for-vscode">here</a> for more details.</p>
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2019/04/09/release-schedule">Release 5.0.1</a></h1><p class="post-meta">April 9, 2019</p><div class="authorBlock"></div></header><article class="post-content"><div><span><p><code>bs-platform@5.0.1</code> preview is available, try <code>npm i -g bs-platform@beta-4.02</code>! A detailed a list of changes is available <a href="https://github.com/BuckleScript/bucklescript/blob/master/Changes.md#501">here</a></p>
<p>Some notable new features in this release:</p>
<ul>
<li><p>react jsx v3 is available which means zero-cost for react-bindings (@rickyvetter will talk about it in a separate post)</p></li>
<li><p>bs.inline for library authors. Our compilers have a pretty good inlining heuristics by default, in this release, we allow some user input for some fine-tuned inlining behavior. Read this (<a href="https://github.com/BuckleScript/bucklescript/issues/3472">https://github.com/BuckleScript/bucklescript/issues/3472</a>) for more use cases.
A typical usage is as below</p>
<pre><code class="hljs"><span class="hljs-keyword">module</span> <span class="hljs-module-identifier">Platform</span> = struct
    <span class="hljs-keyword">let</span> ios = <span class="hljs-string">"ios"</span> <span class="hljs-attribute">[@@bs.inline]</span>
end    
</code></pre>
<p>If user wants to write an interface, it has to carry the payload though:</p>
<pre><code class="hljs"><span class="hljs-keyword">module</span> <span class="hljs-module-identifier">Platform</span> : sig
    <span class="hljs-keyword">val</span> ios : string <span class="hljs-attribute">[@@bs.inline "ios"]</span>
end = struct
    <span class="hljs-keyword">let</span> ios = <span class="hljs-string">"ios"</span> <span class="hljs-attribute">[@@bs.inline]</span>
end    
</code></pre>
<p>It is a bit verbose for library authors, but this should be transparent to library users.</p></li>
</ul>
<p>We are also actively working on a new offical release targeted to OCaml 4.06 for the forthcoming <a href="https://www.reason-conf.com/">reason-conf</a>, below is proposed release schedule:</p>
<p>We are going to support OCaml 4.06 and 4.02 at the same time for a while.</p>
<p>The corresponding versions for <code>bs-platform</code> would be 5.(targeting 4.02 OCaml) and 6. (targeting 4.06).</p>
<p><code>5.*</code> is recommended for production usage, bug fix is prioritized (tagged as <code>beta-4.02</code> for pre-rleases)</p>
<p><code>6.*</code> is expected to have some issues but encouraged to experiment until we make an official announcement it is great for production. (tagged as <code>beta-4.06</code> for pre-releases)</p>
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2019/03/31/release-6-0">bs-platform release v6.0+dev</a></h1><p class="post-meta">March 31, 2019</p><div class="authorBlock"></div></header><article class="post-content"><div><span><p><code>bs-platform@6.0.0-dev.1</code> is released, you can try it with <code>npm i -g bs-platform@next</code>!
(if you have permission issues, try <code>sudo npm i --unsafe-perm -g bs-platform@next</code>)</p>
<p>This is the first release that bucklescript compiler using OCaml 4.06.1 typechecker.</p>
<p>It also means that most language features from OCaml will trickle down automatically.</p>
<p>It is not yet ready for production but we recommend you to try it (esp, new OCaml features between 4.02.3 and 4.06.1),
note we expect users to have some issues in experiment, feedback is welcome!</p>
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2019/03/21/release-5-0">bs-platform release v5</a></h1><p class="post-meta">March 21, 2019</p><div class="authorBlock"></div></header><article class="post-content"><div><span><p><code>bs-platform@5.0.0</code> is released! There are quite a few bug fixes in this release  and refmt is synced up, a detailed list of changes is available <a href="https://github.com/BuckleScript/bucklescript/blob/master/Changes.md#500">here</a>.</p>
<p>Several new features are introduced in this release:</p>
<ul>
<li><p>first class <code>bs.variadic</code> support, documented <a href="https://bucklescript.github.io/blog/2019/03/1/feature-preview">here</a></p></li>
<li><p>we prebuilt binaries for Windows, MacOS and Linux, this will help reduce your CI build time significantly. For exotic OSes, it will fall back to build from source</p></li>
<li><p>bs.deriving light config. For people who prefer short names, we make it configurable</p></li>
</ul>
<pre><code class="hljs"><span class="hljs-keyword">type</span> t = {
    x : int
} <span class="hljs-attribute">[@@bs.deriving {abstract = light}]</span>

<span class="hljs-keyword">let</span> f (obj : t) = obj |. x 
</code></pre>
<p>This is the last major release which is targeting OCaml 4.02.3, in the future we will make major releases targeting OCaml 4.06.</p>
<p>Happy Hacking!</p>
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2019/01/11/scalable">In search of lightning feedback loop in a large codebase</a></h1><p class="post-meta">January 11, 2019</p><div class="authorBlock"></div></header><article class="post-content"><div><span><p>As software developers, when we touch a codebase, we want the edit-compile cycle, to be as short as possible. Studies show that feedback loop less than 1s, or 100ms will prevent devleopers getting distracted.</p>
<p>This seems to be possible in a small project, but as project grows to 10k files, or even more,
100k files in a large company like Google, Facebook, this seems to be extremely challenging.</p>
<p>In this article, we are talking about how BuckleScript - it supports both OCaml and ReasonML syntax - is trying to solve this issue.</p>
<p>The edit-build cycle in BuckleScript consists of two components: the compiler which does type checking and code generation and the scheduler which figures out what to rebuild and how to do it concurrently.</p>
<h2><a class="anchor" aria-hidden="true" id="the-importance-of-compilers-cold-performance"></a><a href="#the-importance-of-compilers-cold-performance" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The importance of compiler's cold performance</h2>
<p>In order to reduce the edit-build latency, some languages adopt an approach of in memory compiler + watch mode. We think this is not a scalable or reliable approach.</p>
<p>A compiler is a complex piece of software, the chance that a compiler has memory leak is not low. It is not observed in real world since compiler is used mostly in a short-lived setting, it starts up fast and dies off quickly.</p>
<p>However, this is decimated when compiler is put in server mode. When we have 10k or 100k files held in memory, it is very easy to observe OOM (out of memory issues).</p>
<p>We figured that to deliver a scalable and reliable system, it is better to decouple the compiler's complexity from the scheduler. When the compiler cold starts and dies off quickly, the operating system process mechanism serves as an obviously correct garbage collector, which increases the reliability of the whole system.</p>
<p>To reduce such latency in a single compiler's workload, we spent lots of time tweaking the performance of the compiler itself, for example, rewriting the hot path in C code, most BuckleScript compiler source code is written in an imperative C-style to avoid allocation.</p>
<p>To have a general idea of how fast BuckleScript's compiler runs:</p>
<pre><code class="hljs">test&gt;cat fib.ml
<span class="hljs-keyword">let</span> rec fib = function
  | <span class="hljs-type">0</span> | <span class="hljs-type">1</span> -&gt; <span class="hljs-number">1</span>
  | <span class="hljs-type">n</span> -&gt; fib (n - <span class="hljs-number">1</span>) + fib (n - <span class="hljs-number">2</span>)
</code></pre>
<pre><code class="hljs">test&gt;time /usr/local/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">node_modules</span>/<span class="hljs-title">bs</span>-<span class="hljs-title">platform</span>/<span class="hljs-title">lib</span>/<span class="hljs-title">bsc</span>.<span class="hljs-title">exe</span> -<span class="hljs-title">bs</span>-<span class="hljs-title">cmi</span> -<span class="hljs-title">bs</span>-<span class="hljs-title">cmj</span> -<span class="hljs-title">c</span> <span class="hljs-title">fib</span>.<span class="hljs-title">ml</span></span>

real    <span class="hljs-number">0</span>m0.<span class="hljs-number">0</span>08s
user    <span class="hljs-number">0</span>m0.<span class="hljs-number">0</span>04s
sys     <span class="hljs-number">0</span>m0.<span class="hljs-number">0</span>03s
</code></pre>
<p>Having a compiler run fast with a cold start lays the groundwork so that it won't be the bottleneck in the whole process. This is because when the architecture decouple the compiler from the scheduler, the compiler will be invoked by the scheduler hunderds of thousands of times in a build cycle, the latency of the compiler in a single compilation unit will add up.</p>
<h2><a class="anchor" aria-hidden="true" id="the-art-of-being-incremental"></a><a href="#the-art-of-being-incremental" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The art of being incremental</h2>
<p>Having a compiler running fast in cold mode does not solve the scalability issue alone. Take a code base which contains 100K source files for example, 100ms per file would result in 10,000s latency which is not acceptable. To solve such issue, we need reduce the workload as much as possible during each edit-build cycle.</p>
<p>In a statically typed language, suppose we have two compilation units A , B, and B depends on A. Whenever A changes, B gets recompiled, to make it worse, the recompilation propogates, all dependencies of B get recompiled, which will result in a snowball effect. In this model, whenever we touch the non-leaf compilation unit, the latency would be large.</p>
<p>The key observation here for BuckleScript is that B does not really
depend on the last modified time of A, it depends on the intermediate output of A (e.g, <code>.cmj</code> and <code>.cmi</code> file) which may not change even if we modify A. What we work on here is to reduce the probability of changing A's intermediate output due to changing A. With the integration of a scheduler, it can help stop the propagation as early as possible.</p>
<p>In BuckleScript, each compilation unit is composed of two files, the implementation file and interface file which are compiled to intermediate output .cmj and .cmi separately.</p>
<p>The interface builds are completely separate from implemetation, it does not depend on .cmj (implementation intermediate output) at all.</p>
<p>Suppose the interface is not changed, whenever we touch the implementation file, BuckleScript designs the data structure of <code>.cmj</code> in a way that the content of <code>.cmj</code> is seldom changed. (Let's say its probability is 0.05 which is rare in cases when the arity of a function changed)</p>
<p>If neither <code>.cmj</code> nor <code>.cmi</code>  gets changed, the scheduler would stop propagation.</p>
<p>Suppose the <code>.cmj</code> file is still changed (P = 0.05), A's dependency B would get recompiled. Note <code>B.cmi</code> only depends on <code>A.cmi</code>, so it will not get compiled, only <code>B.cmj</code> will get recompiled, its chances that <code>B.cmj</code> gets changed will be even lower. In practice, the probabiity of the length of propagation chain is more than two is less than</p>
<pre><code class="hljs"><span class="hljs-number">0.05</span> * <span class="hljs-number">0.05</span> = <span class="hljs-number">0.0025</span>
</code></pre>
<p>This means when we are in an edit-build cycle, whenever A gets changed, it may have many direct dependencies, but the longest rebuild sequence will get settled in at most two compilation units. Suppose the scheduler schedule the tasks in parallel, the longest sequence is bound by two, which means the rebuild cycle is very close to compiling two compilation units.</p>
<p>In implementation, we also generalized the idea of stopping propogation of .cmi changes, so whenever we are adding some comments in the interface file, it will
get settled quickly.</p>
<p>The worst case is that the root of an interface changed. In such case, it does not mean all its dependencies will get recompiled, it depends on how many dependencies' interface depend on the root's interface. The cool thing is that since interface's dependency chain is completely decoupled from implementation's dependency, actually it used to be a subset of implementation's dependency chain, so only a subset of its dependencies will get compiled. We will see a concrete an example later.</p>
<h2><a class="anchor" aria-hidden="true" id="a-fast-scheduler"></a><a href="#a-fast-scheduler" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A fast scheduler</h2>
<p>As we said, the time spent in an edit-build cycle is mostly composed of two parts: compiling invoking the compiler, scheduling.</p>
<p>We are reusing the very fast scheduler provided by <a href="https://ninja-build.org/manual.html">Ninja</a></p>
<blockquote>
<p>Where other build systems are high-level languages, Ninja aims to be an assembler.</p>
</blockquote>
<p>BuckleScript outputs assembler style instructions consumed by
Ninja which does scheduling very fast and provides good parallelism. By integrating with Ninja's <code>restat</code> attribute, we are able to implement the idea of a specialized content based build system.</p>
<p>It is fast enough for 99% of use cases. For a project less than 1k files, the time spent in an edit-build cycle is dominated by the compiler, but as project grows to 10K files or even more, the time spent in compiler is stable and bounded due to our incremental design, however, the time will start be dominated by the scheduler.</p>
<p>For a nop build around 10k files, it takes around 700ms for Ninja to figure out nothing needs to be rebuilt.</p>
<p>The current Ninja model is simple, every time it is invoked, it will re-read build.ninja instructions, check stats of artifacts and do the scheduling.</p>
<p>Instead of making a long-lived compiler, we propose to have a long-lived scheduler. The complexity of a scheduler is significantly lower than a compiler.
Having an in-memory scheduler will help reducing redundant work such as parsing build.ninja instructions which is around of size 2M for 10k files. With the integration of  watch mode, it does not need stat all artifacts each time, this should help increase the scalability of scheduler to 100K files or even more.</p>
<h2><a class="anchor" aria-hidden="true" id="tests-on-a-synthetic-benchmark"></a><a href="#tests-on-a-synthetic-benchmark" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Tests on a synthetic benchmark</h2>
<p>Our synthetic bench is borrowed from <a href="http://blog.camlcity.org/blog/omake1.html">OMake</a> and public available <a href="https://github.com/bucklescript/bsb-bench">here</a>.</p>
<blockquote>
<p>The benchmark has these characteristics: The task is to build n^2 libraries with n^2 modules each (for a given small number n), and the dependencies between the modules are created in a way so that we can stress both the dependency analyzer of the build utility and the ability to run commands in parallel.</p>
</blockquote>
<p>We modified the benchmark to add interface file for each implementation file.</p>
<p>The benchmark is running on MacBook Pro 18 with CPU 2.6 GHz Intel Core i7, Memory 32 GB 2400 MHz DDR4</p>
<p>The test is running against <code>n = 3,5,7,9</code>, where the source code size would be <code>2*3^4=162</code>, <code>2*5^4=1250</code>, <code>2*7^4=4802</code>, <code>2*9**4=13122</code>.</p>
<p>Below is what we get for a cold build from scratch:</p>
<table>
<thead>
<tr><th>Source size</th><th>Clean build (ms)</th></tr>
</thead>
<tbody>
<tr><td>0162</td><td>684</td></tr>
<tr><td>1250</td><td>5,100</td></tr>
<tr><td>4802</td><td>24,112</td></tr>
<tr><td>13122</td><td>125,248</td></tr>
</tbody>
</table>
<table>
<thead>
<tr><th>Source size</th><th>Nop build (ms)</th><th>Touching root module (m_1_1_1_1.ml)</th><th>Touching (m_1_1_1.mli)</th></tr>
</thead>
<tbody>
<tr><td>0162</td><td>16</td><td>59</td><td>54</td></tr>
<tr><td>1250</td><td>79</td><td>120</td><td>133</td></tr>
<tr><td>4802</td><td>266</td><td>369</td><td>367</td></tr>
<tr><td>13122</td><td>728</td><td>963</td><td>962</td></tr>
</tbody>
</table>
<p>We can see from the table as size grows, the time spent in edit-build cycle shifts from compilation to the scheduler, this is due to the fact that Ninja scheduler does not save the work for each test.</p>
<table>
<thead>
<tr><th>Source size</th><th>Adding value to root module (m_1_1_1_1.ml)</th><th>Changing root interface</th></tr>
</thead>
<tbody>
<tr><td>0162</td><td>56</td><td>70</td></tr>
<tr><td>1250</td><td>131</td><td>155</td></tr>
<tr><td>4802</td><td>370</td><td>428</td></tr>
<tr><td>13122</td><td>969</td><td>991</td></tr>
</tbody>
</table>
<p>The verbose build log for adding values on source of size <code>13122</code> is as below:</p>
<pre><code class="hljs">test9&gt;ninja <span class="hljs-operator">-</span><span class="hljs-constructor">C</span> lib<span class="hljs-operator">/</span>bs <span class="hljs-operator">-</span>v
ninja: <span class="hljs-constructor">Entering</span> directory <span class="hljs-constructor">`lib</span><span class="hljs-operator">/</span>bs'
<span class="hljs-literal">[</span><span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">2</span><span class="hljs-literal">]</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>local<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>node_modules<span class="hljs-operator">/</span>bs<span class="hljs-operator">-</span>platform<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>bsc.exe    <span class="hljs-operator">-</span>w <span class="hljs-operator">-</span><span class="hljs-number">30</span><span class="hljs-operator">-</span><span class="hljs-number">40</span><span class="hljs-operator">+</span><span class="hljs-number">6</span><span class="hljs-operator">+</span><span class="hljs-number">7</span><span class="hljs-operator">+</span><span class="hljs-number">27</span><span class="hljs-operator">+</span><span class="hljs-number">32.</span>.<span class="hljs-number">39</span><span class="hljs-operator">+</span><span class="hljs-number">44</span><span class="hljs-operator">+</span><span class="hljs-number">45</span><span class="hljs-operator">+</span><span class="hljs-number">101</span> <span class="hljs-operator">-</span>nostdlib <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> '<span class="hljs-operator">/</span><span class="hljs-constructor">Users</span><span class="hljs-operator">/</span>hongbozhang<span class="hljs-operator">/</span>git<span class="hljs-operator">/</span>bsb<span class="hljs-operator">-</span>bench<span class="hljs-operator">/</span>test9<span class="hljs-operator">/</span>node_modules<span class="hljs-operator">/</span>bs<span class="hljs-operator">-</span>platform<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>ocaml' <span class="hljs-operator">-</span>color always <span class="hljs-operator">-</span>c <span class="hljs-operator">-</span>o src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_1_1.mlast <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>syntax<span class="hljs-operator">-</span>only <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>binary<span class="hljs-operator">-</span>ast <span class="hljs-operator">/</span><span class="hljs-constructor">Users</span><span class="hljs-operator">/</span>hongbozhang<span class="hljs-operator">/</span>git<span class="hljs-operator">/</span>bsb<span class="hljs-operator">-</span>bench<span class="hljs-operator">/</span>test9<span class="hljs-operator">/</span>src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_1_1.ml
<span class="hljs-literal">[</span><span class="hljs-number">2</span><span class="hljs-operator">/</span><span class="hljs-number">2</span><span class="hljs-literal">]</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>local<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>node_modules<span class="hljs-operator">/</span>bs<span class="hljs-operator">-</span>platform<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>bsb_helper.exe  <span class="hljs-operator">-</span>g <span class="hljs-number">0</span> <span class="hljs-operator">-</span><span class="hljs-constructor">MD</span> src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_1_1.mlast
<span class="hljs-literal">[</span><span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">5905</span><span class="hljs-literal">]</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>local<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>node_modules<span class="hljs-operator">/</span>bs<span class="hljs-operator">-</span>platform<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>bsc.exe <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>name test  <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>output commonjs:lib<span class="hljs-operator">/</span>js<span class="hljs-operator">/</span>src<span class="hljs-operator">/</span>dir_1_1 <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>assume<span class="hljs-operator">-</span>has<span class="hljs-operator">-</span>mli <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>builtin<span class="hljs-operator">-</span>ppx<span class="hljs-operator">-</span>ml <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>implicit<span class="hljs-operator">-</span><span class="hljs-keyword">include</span>   <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_4_6 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_4_1 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_4_8 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_6_5 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_6_2 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_8_3 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_8_4 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_2_3 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_2_4 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_6_3 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_4_9 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_6_4 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_4_7 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_2_5 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_2_2 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_8_5 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_8_2 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_9_9 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_3_7 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_1_3 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_9_7 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_3_9 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_1_4 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_7_6 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_7_1 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_5_5 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_7_8 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_5_2 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_3_8 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_9_6 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_1_5 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_9_1 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_1_2 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_3_6 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_9_8 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_3_1 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_5_3 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_5_4 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_7_9 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_7_7 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_8_7 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_2_9 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_8_9 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_2_7 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_4_2 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_6_8 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_4_5 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_6_1 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_6_6 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_2_1 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_2_6 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_8_8 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_8_1 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_2_8 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_8_6 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_6_7 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_6_9 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_4_4 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_4_3 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_7_2 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_7_5 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_5_8 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_5_1 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_5_6 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_1_9 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_3_4 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_3_3 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_9_4 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_1_7 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_9_3 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_5_7 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_7_4 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_5_9 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_7_3 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_9_2 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_1_1 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_9_5 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_1_6 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_3_2 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_1_8 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_3_5  <span class="hljs-operator">-</span>w <span class="hljs-operator">-</span><span class="hljs-number">30</span><span class="hljs-operator">-</span><span class="hljs-number">40</span><span class="hljs-operator">+</span><span class="hljs-number">6</span><span class="hljs-operator">+</span><span class="hljs-number">7</span><span class="hljs-operator">+</span><span class="hljs-number">27</span><span class="hljs-operator">+</span><span class="hljs-number">32.</span>.<span class="hljs-number">39</span><span class="hljs-operator">+</span><span class="hljs-number">44</span><span class="hljs-operator">+</span><span class="hljs-number">45</span><span class="hljs-operator">+</span><span class="hljs-number">101</span> <span class="hljs-operator">-</span>nostdlib <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> '<span class="hljs-operator">/</span><span class="hljs-constructor">Users</span><span class="hljs-operator">/</span>hongbozhang<span class="hljs-operator">/</span>git<span class="hljs-operator">/</span>bsb<span class="hljs-operator">-</span>bench<span class="hljs-operator">/</span>test9<span class="hljs-operator">/</span>node_modules<span class="hljs-operator">/</span>bs<span class="hljs-operator">-</span>platform<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>ocaml' <span class="hljs-operator">-</span>color always <span class="hljs-operator">-</span>o src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_1_1.cmj <span class="hljs-operator">-</span>c  src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_1_1.mlast 
<span class="hljs-constructor">File</span> <span class="hljs-string">"/Users/hongbozhang/git/bsb-bench/test9/src/dir_1_1/m_1_1_1_1.ml"</span>, line <span class="hljs-number">4</span>, characters <span class="hljs-number">4</span><span class="hljs-operator">-</span><span class="hljs-number">5</span>:
<span class="hljs-constructor">Warning</span> <span class="hljs-number">32</span>: unused value a.

</code></pre>
<p>Ignoring the preprocess stage, We can see there are 5906 jobs scheduled but only one job is processed. This is because adding a single value does not change <code>m_1_1_1_1.cmj</code> so that the change of propogation is stopped immediately.</p>
<p>The result is surprisingly good even if change the interface of root files, by looking at the verbose build log:</p>
<pre><code class="hljs">test9&gt;ninja <span class="hljs-operator">-</span><span class="hljs-constructor">C</span> lib<span class="hljs-operator">/</span>bs <span class="hljs-operator">-</span>v
ninja: <span class="hljs-constructor">Entering</span> directory <span class="hljs-constructor">`lib</span><span class="hljs-operator">/</span>bs'
<span class="hljs-literal">[</span><span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">2</span><span class="hljs-literal">]</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>local<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>node_modules<span class="hljs-operator">/</span>bs<span class="hljs-operator">-</span>platform<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>bsc.exe    <span class="hljs-operator">-</span>w <span class="hljs-operator">-</span><span class="hljs-number">30</span><span class="hljs-operator">-</span><span class="hljs-number">40</span><span class="hljs-operator">+</span><span class="hljs-number">6</span><span class="hljs-operator">+</span><span class="hljs-number">7</span><span class="hljs-operator">+</span><span class="hljs-number">27</span><span class="hljs-operator">+</span><span class="hljs-number">32.</span>.<span class="hljs-number">39</span><span class="hljs-operator">+</span><span class="hljs-number">44</span><span class="hljs-operator">+</span><span class="hljs-number">45</span><span class="hljs-operator">+</span><span class="hljs-number">101</span> <span class="hljs-operator">-</span>nostdlib <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> '<span class="hljs-operator">/</span><span class="hljs-constructor">Users</span><span class="hljs-operator">/</span>hongbozhang<span class="hljs-operator">/</span>git<span class="hljs-operator">/</span>bsb<span class="hljs-operator">-</span>bench<span class="hljs-operator">/</span>test9<span class="hljs-operator">/</span>node_modules<span class="hljs-operator">/</span>bs<span class="hljs-operator">-</span>platform<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>ocaml' <span class="hljs-operator">-</span>color always <span class="hljs-operator">-</span>c <span class="hljs-operator">-</span>o src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_1_1.mliast <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>syntax<span class="hljs-operator">-</span>only <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>binary<span class="hljs-operator">-</span>ast <span class="hljs-operator">/</span><span class="hljs-constructor">Users</span><span class="hljs-operator">/</span>hongbozhang<span class="hljs-operator">/</span>git<span class="hljs-operator">/</span>bsb<span class="hljs-operator">-</span>bench<span class="hljs-operator">/</span>test9<span class="hljs-operator">/</span>src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_1_1.mli
<span class="hljs-literal">[</span><span class="hljs-number">2</span><span class="hljs-operator">/</span><span class="hljs-number">2</span><span class="hljs-literal">]</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>local<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>node_modules<span class="hljs-operator">/</span>bs<span class="hljs-operator">-</span>platform<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>bsb_helper.exe  <span class="hljs-operator">-</span>g <span class="hljs-number">0</span> <span class="hljs-operator">-</span><span class="hljs-constructor">MD</span> src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_1_1.mliast
<span class="hljs-literal">[</span><span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">5906</span><span class="hljs-literal">]</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>local<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>node_modules<span class="hljs-operator">/</span>bs<span class="hljs-operator">-</span>platform<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>bsc.exe <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>name test  <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>output commonjs:lib<span class="hljs-operator">/</span>js<span class="hljs-operator">/</span>src<span class="hljs-operator">/</span>dir_1_1 <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>builtin<span class="hljs-operator">-</span>ppx<span class="hljs-operator">-</span>mli <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>implicit<span class="hljs-operator">-</span><span class="hljs-keyword">include</span>  <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_4_6 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_4_1 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_4_8 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_6_5 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_6_2 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_8_3 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_8_4 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_2_3 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_2_4 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_6_3 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_4_9 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_6_4 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_4_7 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_2_5 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_2_2 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_8_5 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_8_2 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_9_9 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_3_7 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_1_3 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_9_7 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_3_9 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_1_4 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_7_6 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_7_1 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_5_5 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_7_8 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_5_2 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_3_8 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_9_6 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_1_5 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_9_1 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_1_2 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_3_6 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_9_8 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_3_1 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_5_3 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_5_4 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_7_9 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_7_7 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_8_7 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_2_9 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_8_9 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_2_7 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_4_2 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_6_8 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_4_5 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_6_1 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_6_6 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_2_1 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_2_6 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_8_8 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_8_1 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_2_8 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_8_6 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_6_7 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_6_9 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_4_4 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_4_3 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_7_2 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_7_5 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_5_8 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_5_1 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_5_6 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_1_9 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_3_4 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_3_3 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_9_4 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_1_7 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_9_3 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_5_7 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_7_4 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_5_9 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_7_3 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_9_2 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_1_1 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_9_5 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_1_6 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_3_2 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_1_8 <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> src<span class="hljs-operator">/</span>dir_3_5  <span class="hljs-operator">-</span>w <span class="hljs-operator">-</span><span class="hljs-number">30</span><span class="hljs-operator">-</span><span class="hljs-number">40</span><span class="hljs-operator">+</span><span class="hljs-number">6</span><span class="hljs-operator">+</span><span class="hljs-number">7</span><span class="hljs-operator">+</span><span class="hljs-number">27</span><span class="hljs-operator">+</span><span class="hljs-number">32.</span>.<span class="hljs-number">39</span><span class="hljs-operator">+</span><span class="hljs-number">44</span><span class="hljs-operator">+</span><span class="hljs-number">45</span><span class="hljs-operator">+</span><span class="hljs-number">101</span> <span class="hljs-operator">-</span>nostdlib <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> '<span class="hljs-operator">/</span><span class="hljs-constructor">Users</span><span class="hljs-operator">/</span>hongbozhang<span class="hljs-operator">/</span>git<span class="hljs-operator">/</span>bsb<span class="hljs-operator">-</span>bench<span class="hljs-operator">/</span>test9<span class="hljs-operator">/</span>node_modules<span class="hljs-operator">/</span>bs<span class="hljs-operator">-</span>platform<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>ocaml' <span class="hljs-operator">-</span>color always <span class="hljs-operator">-</span>o src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_1_1.cmi <span class="hljs-operator">-</span>c  src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_1_1.mliast
<span class="hljs-literal">[</span><span class="hljs-number">2</span><span class="hljs-operator">/</span><span class="hljs-number">5906</span><span class="hljs-literal">]</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>local<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>node_modules<span class="hljs-operator">/</span>bs<span class="hljs-operator">-</span>platform<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>bsc.exe <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>name test  <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>output commonjs:lib<span class="hljs-operator">/</span>js<span class="hljs-operator">/</span>src<span class="hljs-operator">/</span>dir_1_1 <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>assume<span class="hljs-operator">-</span>has<span class="hljs-operator">-</span>mli <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>builtin<span class="hljs-operator">-</span>ppx<span class="hljs-operator">-</span>ml <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>implicit<span class="hljs-operator">-</span><span class="hljs-keyword">include</span>   <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> <span class="hljs-operator">...</span>  <span class="hljs-operator">-</span>color always <span class="hljs-operator">-</span>o src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_1_1.cmj <span class="hljs-operator">-</span>c  src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_1_1.mlast 
<span class="hljs-literal">[</span><span class="hljs-number">3</span><span class="hljs-operator">/</span><span class="hljs-number">5906</span><span class="hljs-literal">]</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>local<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>node_modules<span class="hljs-operator">/</span>bs<span class="hljs-operator">-</span>platform<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>bsc.exe <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>name test  <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>output commonjs:lib<span class="hljs-operator">/</span>js<span class="hljs-operator">/</span>src<span class="hljs-operator">/</span>dir_1_1 <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>assume<span class="hljs-operator">-</span>has<span class="hljs-operator">-</span>mli <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>builtin<span class="hljs-operator">-</span>ppx<span class="hljs-operator">-</span>ml <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>implicit<span class="hljs-operator">-</span><span class="hljs-keyword">include</span>   <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> <span class="hljs-operator">...</span>  <span class="hljs-operator">-</span>w <span class="hljs-operator">-</span><span class="hljs-number">30</span><span class="hljs-operator">-</span><span class="hljs-number">40</span><span class="hljs-operator">+</span><span class="hljs-number">6</span><span class="hljs-operator">+</span><span class="hljs-number">7</span><span class="hljs-operator">+</span><span class="hljs-number">27</span><span class="hljs-operator">+</span><span class="hljs-number">32.</span>.<span class="hljs-number">39</span><span class="hljs-operator">+</span><span class="hljs-number">44</span><span class="hljs-operator">+</span><span class="hljs-number">45</span><span class="hljs-operator">+</span><span class="hljs-number">101</span> <span class="hljs-operator">-</span>nostdlib <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> '<span class="hljs-operator">/</span><span class="hljs-constructor">Users</span><span class="hljs-operator">/</span>hongbozhang<span class="hljs-operator">/</span>git<span class="hljs-operator">/</span>bsb<span class="hljs-operator">-</span>bench<span class="hljs-operator">/</span>test9<span class="hljs-operator">/</span>node_modules<span class="hljs-operator">/</span>bs<span class="hljs-operator">-</span>platform<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>ocaml' <span class="hljs-operator">-</span>color always <span class="hljs-operator">-</span>o src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_2_2.cmj <span class="hljs-operator">-</span>c  src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_2_2.mlast 
<span class="hljs-literal">[</span><span class="hljs-number">4</span><span class="hljs-operator">/</span><span class="hljs-number">5906</span><span class="hljs-literal">]</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>local<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>node_modules<span class="hljs-operator">/</span>bs<span class="hljs-operator">-</span>platform<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>bsc.exe <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>name test  <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>output commonjs:lib<span class="hljs-operator">/</span>js<span class="hljs-operator">/</span>src<span class="hljs-operator">/</span>dir_1_1 <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>assume<span class="hljs-operator">-</span>has<span class="hljs-operator">-</span>mli <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>builtin<span class="hljs-operator">-</span>ppx<span class="hljs-operator">-</span>ml <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>implicit<span class="hljs-operator">-</span><span class="hljs-keyword">include</span>   <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> <span class="hljs-operator">...</span> <span class="hljs-operator">-</span>color always <span class="hljs-operator">-</span>o src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_2_1.cmj <span class="hljs-operator">-</span>c  src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_2_1.mlast 
<span class="hljs-literal">[</span><span class="hljs-number">5</span><span class="hljs-operator">/</span><span class="hljs-number">5906</span><span class="hljs-literal">]</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>local<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>node_modules<span class="hljs-operator">/</span>bs<span class="hljs-operator">-</span>platform<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>bsc.exe <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>name test  <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>output commonjs:lib<span class="hljs-operator">/</span>js<span class="hljs-operator">/</span>src<span class="hljs-operator">/</span>dir_1_1 <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>assume<span class="hljs-operator">-</span>has<span class="hljs-operator">-</span>mli <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>builtin<span class="hljs-operator">-</span>ppx<span class="hljs-operator">-</span>ml <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>implicit<span class="hljs-operator">-</span><span class="hljs-keyword">include</span>   <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> <span class="hljs-operator">...</span> <span class="hljs-operator">-</span>color always <span class="hljs-operator">-</span>o src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_2_3.cmj <span class="hljs-operator">-</span>c  src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_2_3.mlast 
<span class="hljs-literal">[</span><span class="hljs-number">6</span><span class="hljs-operator">/</span><span class="hljs-number">5906</span><span class="hljs-literal">]</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>local<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>node_modules<span class="hljs-operator">/</span>bs<span class="hljs-operator">-</span>platform<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>bsc.exe <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>name test  <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>output commonjs:lib<span class="hljs-operator">/</span>js<span class="hljs-operator">/</span>src<span class="hljs-operator">/</span>dir_1_1 <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>assume<span class="hljs-operator">-</span>has<span class="hljs-operator">-</span>mli <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>builtin<span class="hljs-operator">-</span>ppx<span class="hljs-operator">-</span>ml <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>implicit<span class="hljs-operator">-</span><span class="hljs-keyword">include</span>   <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> <span class="hljs-operator">...</span> <span class="hljs-operator">-</span>color always <span class="hljs-operator">-</span>o src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_2_9.cmj <span class="hljs-operator">-</span>c  src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_2_9.mlast 
<span class="hljs-literal">[</span><span class="hljs-number">7</span><span class="hljs-operator">/</span><span class="hljs-number">5906</span><span class="hljs-literal">]</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>local<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>node_modules<span class="hljs-operator">/</span>bs<span class="hljs-operator">-</span>platform<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>bsc.exe <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>name test  <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>output commonjs:lib<span class="hljs-operator">/</span>js<span class="hljs-operator">/</span>src<span class="hljs-operator">/</span>dir_1_1 <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>assume<span class="hljs-operator">-</span>has<span class="hljs-operator">-</span>mli <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>builtin<span class="hljs-operator">-</span>ppx<span class="hljs-operator">-</span>ml <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>implicit<span class="hljs-operator">-</span><span class="hljs-keyword">include</span>   <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> <span class="hljs-operator">...</span> <span class="hljs-operator">-</span>color always <span class="hljs-operator">-</span>o src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_2_4.cmj <span class="hljs-operator">-</span>c  src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_2_4.mlast 
<span class="hljs-literal">[</span><span class="hljs-number">8</span><span class="hljs-operator">/</span><span class="hljs-number">5906</span><span class="hljs-literal">]</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>local<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>node_modules<span class="hljs-operator">/</span>bs<span class="hljs-operator">-</span>platform<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>bsc.exe <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>name test  <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>output commonjs:lib<span class="hljs-operator">/</span>js<span class="hljs-operator">/</span>src<span class="hljs-operator">/</span>dir_1_1 <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>assume<span class="hljs-operator">-</span>has<span class="hljs-operator">-</span>mli <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>builtin<span class="hljs-operator">-</span>ppx<span class="hljs-operator">-</span>ml <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>implicit<span class="hljs-operator">-</span><span class="hljs-keyword">include</span>   <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> <span class="hljs-operator">...</span> <span class="hljs-operator">-</span>color always <span class="hljs-operator">-</span>o src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_2_5.cmj <span class="hljs-operator">-</span>c  src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_2_5.mlast 
<span class="hljs-literal">[</span><span class="hljs-number">9</span><span class="hljs-operator">/</span><span class="hljs-number">5906</span><span class="hljs-literal">]</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>local<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>node_modules<span class="hljs-operator">/</span>bs<span class="hljs-operator">-</span>platform<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>bsc.exe <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>name test  <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>output commonjs:lib<span class="hljs-operator">/</span>js<span class="hljs-operator">/</span>src<span class="hljs-operator">/</span>dir_1_1 <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>assume<span class="hljs-operator">-</span>has<span class="hljs-operator">-</span>mli <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>builtin<span class="hljs-operator">-</span>ppx<span class="hljs-operator">-</span>ml <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>implicit<span class="hljs-operator">-</span><span class="hljs-keyword">include</span>   <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> <span class="hljs-operator">...</span> <span class="hljs-operator">-</span>color always <span class="hljs-operator">-</span>o src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_2_6.cmj <span class="hljs-operator">-</span>c  src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_2_6.mlast 
<span class="hljs-literal">[</span><span class="hljs-number">10</span><span class="hljs-operator">/</span><span class="hljs-number">5906</span><span class="hljs-literal">]</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>local<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>node_modules<span class="hljs-operator">/</span>bs<span class="hljs-operator">-</span>platform<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>bsc.exe <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>name test  <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>output commonjs:lib<span class="hljs-operator">/</span>js<span class="hljs-operator">/</span>src<span class="hljs-operator">/</span>dir_1_1 <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>assume<span class="hljs-operator">-</span>has<span class="hljs-operator">-</span>mli <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>builtin<span class="hljs-operator">-</span>ppx<span class="hljs-operator">-</span>ml <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>implicit<span class="hljs-operator">-</span><span class="hljs-keyword">include</span>   <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> <span class="hljs-operator">...</span> <span class="hljs-operator">-</span>color always <span class="hljs-operator">-</span>o src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_2_7.cmj <span class="hljs-operator">-</span>c  src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_2_7.mlast 
<span class="hljs-literal">[</span><span class="hljs-number">11</span><span class="hljs-operator">/</span><span class="hljs-number">5906</span><span class="hljs-literal">]</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>local<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>node_modules<span class="hljs-operator">/</span>bs<span class="hljs-operator">-</span>platform<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>bsc.exe <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>name test  <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>package<span class="hljs-operator">-</span>output commonjs:lib<span class="hljs-operator">/</span>js<span class="hljs-operator">/</span>src<span class="hljs-operator">/</span>dir_1_1 <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>assume<span class="hljs-operator">-</span>has<span class="hljs-operator">-</span>mli <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>builtin<span class="hljs-operator">-</span>ppx<span class="hljs-operator">-</span>ml <span class="hljs-operator">-</span>bs<span class="hljs-operator">-</span>no<span class="hljs-operator">-</span>implicit<span class="hljs-operator">-</span><span class="hljs-keyword">include</span>   <span class="hljs-operator">-</span><span class="hljs-constructor">I</span> <span class="hljs-operator">...</span> <span class="hljs-operator">-</span>color always <span class="hljs-operator">-</span>o src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_2_8.cmj <span class="hljs-operator">-</span>c  src<span class="hljs-operator">/</span>dir_1_1<span class="hljs-operator">/</span>m_1_1_2_8.mlast
</code></pre>
<p>The log means that there are 5906 jobs to be scheduled but only 11 jobs processed. This is because there only 9 direct dependencies,
the cmj/cmi changes' propogation stops in the first level of dependency, indirect dependencies are not propagated any more since the intermediate representation stays stable after that. There are 9 more jobs to do compared with changing implementation but the latency only increased by 30ms, which means the scheduler does a good job in parallelism.</p>
<p>The real world scenario may be a bit worse than our synthetic benchmark, since our syntethic benchmark only impose dependencies across implementation files, the dependencies across interface files are flat.</p>
<p>To conclude, currently BuckleScript scales very well to projects with around 10k files, and with some work in improving the scheduler, we believe it is not too difficult to scale it to 100K files or even more. To reach such enormous scalability in a reliable way, we propose to have a long-lived scheduler and fast cold compiler. The language interface design and the design of the data structure for the implementation will make the longest rebuild propogation chain bounded by two in most cases.</p>
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2019/01/07/release-4-0-17"></a></h1><p class="post-meta">January 7, 2019</p><div class="authorBlock"></div></header><article class="post-content"><div><span><p><code>bs-platform</code> 4.0.17 is a major release.</p>
<p>It improved incremental compilation time significantly.</p>
<p>A pictue is worth a thousand words, below is a large monorepo which contains 4096 modules, changing the root node which has more than 3000 dependents, it finished building within 400ms.</p>
<p><img src="/img/incremental.png"></p>
<p>We will write a dedicated article explaining how we achieve this incredible build performance.</p>
<p>A detailed list of changes is available <a href="https://github.com/BuckleScript/bucklescript/blob/master/Changes.md#4017">here</a></p>
<p>Another quite important but not client facing change is that we renovated the internal build system, it will be much easier for contribution later on.
We will update the contribution guide once it gets stable.</p>
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2019/03/1/feature-preview">First-class `bs.variadic` Support in the Next Release</a></h1><p class="post-meta">March 1, 2019</p><div class="authorBlock"></div></header><article class="post-content"><div><span><p>In previous releases, when a <code>bs.variadic</code> external (previously called <code>bs.splice</code> prior to version <code>4.08</code>) is present, its tail arguments needed to be applied statically. In other words, the <code>external</code> marked with <code>bs.variadic</code>, when used, requires a <em>literal</em> array:</p>
<pre><code class="hljs css language-ocaml"><span class="hljs-keyword">external</span> join : <span class="hljs-built_in">string</span> <span class="hljs-built_in">array</span> -&gt; <span class="hljs-built_in">string</span> = <span class="hljs-string">"join"</span>
[@@bs.<span class="hljs-keyword">module</span> <span class="hljs-string">"path"</span>][@@bs.variadic]

<span class="hljs-keyword">let</span> _ = join [|<span class="hljs-string">"a"</span>; <span class="hljs-string">"b"</span>|] <span class="hljs-comment">(* this is ok *)</span>
<span class="hljs-keyword">let</span> f b = join b <span class="hljs-comment">(* compiler error when you try to abstract `join` *)</span>
</code></pre>
<pre><code class="hljs css language-reason"><span class="hljs-attribute">[@bs.module "path"]</span><span class="hljs-attribute">[@bs.variadic]</span>
<span class="hljs-keyword">external</span> join: array(string) =&gt; string = <span class="hljs-string">"join"</span>

<span class="hljs-keyword">let</span> _ = join(<span class="hljs-literal">[|</span><span class="hljs-string">"a"</span>, <span class="hljs-string">"b"</span><span class="hljs-literal">|]</span>) <span class="hljs-comment">/* this is ok */</span>
<span class="hljs-keyword">let</span> f = b =&gt; join(b) <span class="hljs-comment">/* compiler error when you try to abstract `join` */</span>
</code></pre>
<p>More importantly, such compilation error was leaky in cases such as this one:</p>
<pre><code class="hljs css language-ocaml"><span class="hljs-keyword">let</span> f = join
</code></pre>
<pre><code class="hljs css language-reason"><span class="hljs-keyword">let</span> f = join
</code></pre>
<p>In the next release, we are going to lift such restriction. You'll be able to call an external marked with <code>bs.variadic</code> with an array reference, not just a literal array.</p>
<p>Caveat: it's unclear how to support such first class <code>bs.variadic</code> call in conjunction with <code>bs.new</code>, so an external declaration that contains both will trigger a compilation error. We'll try to figure out this particular case in the future too.</p>
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2018/12/05/release-4-0-8">BuckleScript 4.0.8 (Part One)</a></h1><p class="post-meta">December 5, 2018</p><div class="authorBlock"></div></header><article class="post-content"><div><span><p>Today we released version 4.0.8 of <code>bs-platform</code>. A detailed list of changes is available <a href="https://github.com/BuckleScript/bucklescript/blob/master/Changes.md#408">here</a>.</p>
<p>Most user-facing changes are bug fixes and small enhancements, while quite a lot of work has been done behind the scenes towards the more fundamental improvements coming down the line. This blog post refers to the BuckleScript runtime and some of the work we are doing to improve it.</p>
<p>The design goal of BuckleScript is to make the runtime as small as possible. This runtime is divided into two parts: the C shims, and the fundamental language feature support.</p>
<p>The C shims are not a strict runtime requirement: in the native backend, the functions are implemented in C, but in BuckleScript this isn't necessary. We can either implement the C shims in a polyfill style or we can just implement them in OCaml and compile via BuckleScript. Recently, we have been shifting more and more work from the runtime to the normal OCaml stdlib by patching it with conditional compilation. The benefit is obvious – they are just normal functions which do not need special compiler support – but the downside is that we might need to make more patches to the libraries which use C functions, but considering the more challenging part of maintaining the patches to the compiler, we think such overhead is worthwhile.</p>
<p>If we ignore the C shims, the BuckleScript runtime is very small, and it is pretty easy for experienced BuckleScript programmers to write runtime-free code which generates standalone JS code. Such code could include supporting curried calling conventions, encoding of OCaml ADT, etc.</p>
<p>The BuckleScript runtime is written in BuckleScript itself. The benefit of this is that it is much more maintainable than implementing in JS itself, and it is easier to keep some invariants when crossing the boundary between the runtime and the stdlib. For example, we don't need to worry about the consistency of the runtime encoding of <code>type tuple</code> in BuckleScript, since the runtime is also implemented in BuckleScript itself, and we get three output modules for free thanks to this &quot;dogfooding&quot;.</p>
<p>However, this makes the build system pretty complicated and fragile, and the dependencies between each module are mostly hard coded. Even worse, this introduces a hard dependency between the normal libraries and the runtime binary artifacts.</p>
<p>In particular, one <a href="https://github.com/BuckleScript/bucklescript/issues/2772">issue</a> we want to address is to make the BuckleScript toolchain lightweight. We will continue to implement the BuckleScript runtime by using BuckleScript itself, but we want to get rid of dependencies like <a href="https://github.com/BuckleScript/bucklescript/issues/3164">the support for exceptions</a>. In the end, installation will no longer involve building the runtime: BuckleScript will simply be a bunch of generated JS files, so the complexity of the build system will not impact users at all. This is quite important given that we are committed to supporting Windows.</p>
<p>In the future, we will therefore be able to distribute the runtime as a normal JS library, and the BuckleScript user will only need the binary compiler and a small set of JS files. They will be able to use stdlib, Belt or anything else.</p>
<p>To get rid of such dependencies between stdlib and the runtime, we are going to introduce a breaking change in the future. In hindsight, our support for catching JS exceptions exposed the concrete representation of the exception encoding, in particular:</p>
<pre><code class="hljs"><span class="hljs-keyword">match</span> ... <span class="hljs-keyword">with</span> 
| <span class="hljs-type">OCamlException</span> <span class="hljs-built_in">exn</span> -&gt; ..
| <span class="hljs-type">Js</span>.<span class="hljs-type">Exn</span>.<span class="hljs-type">Error</span> e -&gt; ...
</code></pre>
<p>In this release, we introduced a function to avoid exposing such exception constructors:</p>
<pre><code class="hljs"><span class="hljs-keyword">match</span> ... <span class="hljs-keyword">with</span> 
| <span class="hljs-type">OCamlException</span> <span class="hljs-built_in">exn</span> -&gt; ...
| e -&gt; 
    <span class="hljs-keyword">match</span> <span class="hljs-type">Js</span>.asJsExn e <span class="hljs-keyword">with</span> 
    | <span class="hljs-type">Some</span> jserror -&gt; ..
    | <span class="hljs-type">None</span> -&gt; ...
</code></pre>
<p>We encourage you to make such changes yourself to future-proof your codebases.</p>
<p>Oh and by the way, one side effect of this refactoring of the BuckleScript runtime is that the compilation does not require reading of the generated <code>.cm*</code> files, which means faster compilation :)</p>
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2018/11/19/next-half">BuckleScript development plans for next half</a></h1><p class="post-meta">November 19, 2018</p><div class="authorBlock"></div></header><article class="post-content"><div><span><p>In this article we will explain what we are doing now and what we plan to improve in next half (Dec-May), we would also like to hear your feedback so that we can adjust accordingly.</p>
<p>Keep in mind that the development team is a very small team, so we have to prioritize things instead of working on every feature.</p>
<h2><a class="anchor" aria-hidden="true" id="what-we-are-doing"></a><a href="#what-we-are-doing" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What we are doing</h2>
<p>In the last couple of month we are busy upgrading the OCaml compiler from 4.02.3 to 4.06.1, the good news is that the upgrade is almost done.</p>
<p>We plan to ship it soon by the end of this year, at the same time, we will still maintain the current version of the compiler until we feel the new compiler is as good as the old one.</p>
<p>Note the upgrade is not easy work since the internals of OCaml compiler changed significantly in the last few years. Our upgrade strategy is also quite conservative, it works by conditional compilation so that the bsc compiler actually work with both versions, the benefit is that in this case, we are not in a messy state, the bug fix of bsc compiler can still benefit two branches.</p>
<p>But the reward is also huge, there are a bunch of optimizations and nice features coming alone in the recent releases of the OCaml language, to name a few: <code>inline records</code>, <code>local exception</code> and <code>hex notation for floats</code> etc. More importantly, this is a great move to engage better with OCaml ecosystem: the previous old version compiler imposed some maintenance overhead for OCaml toolchain, we can make better use of OCaml toolchain after such upgrade.</p>
<h2><a class="anchor" aria-hidden="true" id="whats-next"></a><a href="#whats-next" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What's next</h2>
<h3><a class="anchor" aria-hidden="true" id="making-better-use-of-the-new-compiler-internals"></a><a href="#making-better-use-of-the-new-compiler-internals" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Making better use of the new compiler internals</h3>
<p>The upgrade is divided into two stage, the first stage is focused on <code>no regression</code> so that we can ship it.</p>
<p>Afterwards, we have plans to make better use of the more info rich IR in the new release. Thanks to the flambda introduced after OCaml 4.03, more information is passed down to the lambda IR where BuckleScript take from. For example, user can annotate functions inline or not with inline attribute, we can make better use of such information.</p>
<p>In newer versions of OCaml compiler, the block and array is more distinguished we will investigate whether we can make use of it to provide better data representation for OCaml datatype.</p>
<p>Another interesting direction is to see if we can encode module in a consistent style: as an JS dictionary for both global modules and local modules.</p>
<h3><a class="anchor" aria-hidden="true" id="improving-the-usability-of-bucklescript-toolchain"></a><a href="#improving-the-usability-of-bucklescript-toolchain" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Improving the usability of BuckleScript toolchain</h3>
<p>BuckleScript is focused on making better use of JS ecosystem and provide values to ship JS code in production (produced by BuckleScript).</p>
 <!-- There are still bunch of things to address, most importantly -->
<h4><a class="anchor" aria-hidden="true" id="making-bucklescript-toolchain-more-lightweight"></a><a href="#making-bucklescript-toolchain-more-lightweight" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Making Bucklescript toolchain more lightweight</h4>
<p>Currently it is still too heavy for users to provide JS libraries from BuckleScript, since clients need to install bs-platform which requires a lot of disk-space and native compilation in some platform. We will investigate if we can distribute the native compiler without using npm.</p>
<p>Separate the compiler from stdlib may also help draw the contribution to the stdlib/belt library.</p>
<h4><a class="anchor" aria-hidden="true" id="improving-the-usability-of-bsb"></a><a href="#improving-the-usability-of-bsb" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Improving the usability of bsb</h4>
<p>Currently the bsb is restricted by the npm directory layout, the generated JS artifacts is also restricted by it, we will see if we can relocate the JS artifacts or provide more flexibility for users.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev" href="/blog/">← Prev</a><a class="docs-next" href="/blog/page3/">Next →</a></div></div></div></div></div><span><script src="/js/redirectBlog.js"></script><script>window.foo = new Pjax({
          areas: [
            // try to use the first query.
            '.mainContainer, .docsNavContainer .toc .navWrapper, .onPageNav',
            // fallback
            'body'
          ],
          link: '.docsNavContainer:not(.docsSliderActive) a',
          update: {
            script: false,
          }
        });
        var languagesMenuItemCopy = document.getElementById("languages-menu");
        languagesMenuItemCopy.addEventListener("click", function(e){
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
        });</script></span></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '0fd97db83891aa20810559812d9e69ac',
                indexName: 'bucklescript',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["lang:en"]}
              });
            </script></body></html>